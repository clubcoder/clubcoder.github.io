<script src="https://cdn.firebase.com/js/client/2.4.0/firebase.js"></script>
<style>
    a {
        color: #337ab7;
        text-decoration: none;
    }
    
    a:hover,
    a:focus {
        color: #23527c;
        text-decoration: underline;
    }
    
    a:focus {
        outline: thin dotted;
        outline: 5px auto -webkit-focus-ring-color;
        outline-offset: -2px;
    }
</style>
<h1>Login to club coder to access CCIM and Club Coder products</h1>
<a id="login">Click Here to login with google</a>
<p style="display:none;" id="member">Your email address is not a member. Please try again.</p>
<script>
    /* global Firebase */
    document.getElementById("login").addEventListener("click", function(event) {
        li();
    }, false);

    function keyGen() {
        var text = "";
        var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        for (var i = 0; i < 15; i++)
            text += possible.charAt(Math.floor(Math.random() * possible.length));
        return text;
    }

    function success(email, token) {
        var fb = new Firebase("https://ccim2.firebaseio.com/keys/");
        var username;
        switch (email) {
            case "iandeanc@gmail.com":
                username = "Ian";
                break;
            case "jeffmeng7@gmail.com":
                username = "Jeffrey";
                break;
            case "lucasbchen@gmail.com":
                username = "Lucas";
                break;
            case "chefdude14@gmail.com":
                username = "Daniel";
                break;
            default:
                username = "none";
                break;
        }

        var x = keyGen();
        if (username === "none") {
            document.getElementById("member").style.display = 'block';
        }
        fb.child(x).set(username);
        window.location.href = "http://im.clubcoder.tk/refer.html?token=" + token + "&key=" + x + "&username=" + username + "&continue=http%3A%2F%2Fim.clubcoder.tk%2F";
    }

    function li() {

        var fb = new Firebase("https://ccim2.firebaseio.com");
        if (fb.getAuth()) {
            success(authData.google.email, authData.token);
        }
        fb.authWithOAuthRedirect("google", function(error, authData) {
            if (error) {
                console.log("Login Failed!", error);
            }
            else {
                
            }
        }, {
            scope: "email",
            remeber: "sessionOnly"
        });
    }
    li()
</script>


